<?php
namespace App\Service;

use App\Entity\Product;
use App\Entity\Category;
use Doctrine\ORM\EntityManagerInterface;
use App\Repository\ProductRepository;

class ProductService
{
    private EntityManagerInterface $em;
    private ProductRepository $productRepo;

    public function __construct(EntityManagerInterface $em)
    {
        $this->em = $em;
        $this->productRepo = $em->getRepository(Product::class);
    }

    /**
     * Create new Product and persist it.
     */
    public function createProduct(string $name, float $price, Category $category): Product
    {
        $product = new Product();
        $product->setName($name);
        $product->setPrice($price);
        $product->setCategory($category);
        $this->em->persist($product);
        $this->em->flush();

        return $product;
    }

    /**
     * Get all products
     */
    public function getAllProducts(): array
    {
        return $this->productRepo->findAllProducts();
    }

    /**
     * Update product price
     */
    public function updateProductPrice(int $id, float $newPrice): ?Product
    {
        $product = $this->productRepo->find($id);

        if (!$product) {
            return null;
        }

        $product->setPrice($newPrice);
        $this->em->flush();

        return $product;
    }

    /**
     * Get products with their categories (Eager Loading)
     */
    public function getProductsWithCategories(): array
    {
        return $this->productRepo->findProductsWithCategory();
    }
}
